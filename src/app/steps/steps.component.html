<div class="page container">
  <!-- Header -->
  <div class="header">
    <h1>Gestion des étapes de construction</h1>
    <button class="btn btn-primary" type="button" (click)="openCreate()">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
        <path d="M8 3v10M3 8h10" stroke="#ffffff" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span>Nouvelle étape</span>
    </button>
  </div>

  <!-- Main Card -->
  <div class="card">
    <div class="card-header">
      <h2>Liste des modèles d'étapes</h2>
    </div>

    <div class="table-container">
      <table role="table">
        <thead>
          <tr>
            <th scope="col" class="w-ordre">Ordre</th>
            <th scope="col">Nom de l'étape</th>
            <th scope="col">Spécialité</th>
            <th scope="col">Description</th>
            <th scope="col" class="w-illu">Illustrations</th>
            <th scope="col" class="w-actions">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1</td>
            <td>Obtention du permis de construire</td>
            <td>Administration</td>
            <td>Démarche administrative nécessaire avant de construire</td>
            <td class="illu"><span class="pill pill-blue">1 illustration</span></td>
            <td>
              <div class="action-icons">
                <button class="icon-btn btn-edit" aria-label="Illustrations" (click)="openIllustrations('Obtention du permis de construire')">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="1.8"/>
                    <path d="M3 15l4-4 5 5 3-3 6 6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="9" cy="9" r="1.5" fill="currentColor"/>
                  </svg>
                </button>
                <button class="icon-btn btn-delete" aria-label="Supprimer">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                    <path d="M2 4h12M6 4V2.667A.667.667 0 0 1 6.667 2h2.666A.667.667 0 0 1 10 2.667V4m2 0v9.333a.667.667 0 0 1-.667.667H4.667A.667.667 0 0 1 4 13.333V4h8Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
          <tr>
            <td>2</td>
            <td>Préparation du terrain</td>
            <td>Terrassement</td>
            <td>Nettoyage et nivellement du terrain avant travaux</td>
            <td class="illu"><span class="pill pill-blue">1 illustration</span></td>
            <td>
              <div class="action-icons">
                <button class="icon-btn btn-edit" aria-label="Illustrations" (click)="openIllustrations('Préparation du terrain')">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="1.8"/>
                    <path d="M3 15l4-4 5 5 3-3 6 6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="9" cy="9" r="1.5" fill="currentColor"/>
                  </svg>
                </button>
                <button class="icon-btn btn-delete" aria-label="Supprimer">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                    <path d="M2 4h12M6 4V2.667A.667.667 0 0 1 6.667 2h2.666A.667.667 0 0 1 10 2.667V4m2 0v9.333a.667.667 0 0 1-.667.667H4.667A.667.667 0 0 1 4 13.333V4h8Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
          <tr>
            <td>3</td>
            <td>Fondations</td>
            <td>Maçonnerie</td>
            <td>Mise en place des fondations du bâtiment</td>
            <td class="illu"><span class="pill pill-blue">1 illustration</span></td>
            <td>
              <div class="action-icons">
                <button class="icon-btn btn-edit" aria-label="Illustrations" (click)="openIllustrations('Fondations')">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="1.8"/>
                    <path d="M3 15l4-4 5 5 3-3 6 6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="9" cy="9" r="1.5" fill="currentColor"/>
                  </svg>
                </button>
                <button class="icon-btn btn-delete" aria-label="Supprimer">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                    <path d="M2 4h12M6 4V2.667A.667.667 0 0 1 6.667 2h2.666A.667.667 0 0 1 10 2.667V4m2 0v9.333a.667.667 0 0 1-.667.667H4.667A.667.667 0 0 1 4 13.333V4h8Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
          <tr>
            <td>4</td>
            <td>Charpente et couverture</td>
            <td>Gros œuvre</td>
            <td>Installation de la structure du toit</td>
            <td class="illu"><span class="pill pill-blue">1 illustration</span></td>
            <td>
              <div class="action-icons">
                <button class="icon-btn btn-edit" aria-label="Illustrations" (click)="openIllustrations('Charpente et couverture')">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="1.8"/>
                    <path d="M3 15l4-4 5 5 3-3 6 6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="9" cy="9" r="1.5" fill="currentColor"/>
                  </svg>
                </button>
                <button class="icon-btn btn-delete" aria-label="Supprimer">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                    <path d="M2 4h12M6 4V2.667A.667.667 0 0 1 6.667 2h2.666A.667.667 0 0 1 10 2.667V4m2 0v9.333a.667.667 0 0 1-.667.667H4.667A.667.667 0 0 1 4 13.333V4h8Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
          <tr>
            <td>5</td>
            <td>Plomberie</td>
            <td>Second œuvre</td>
            <td>Installation des réseaux d'eau</td>
            <td class="illu"><span class="pill pill-blue">1 illustration</span></td>
            <td>
              <div class="action-icons">
                <button class="icon-btn btn-edit" aria-label="Modifier">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <rect x="3" y="4" width="18" height="14" rx="2" stroke="currentColor" stroke-width="1.8"/>
                    <path d="M7 13l3-3 4 5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="9" cy="8" r="1.2" fill="currentColor"/>
                  </svg>
                </button>
                <button class="icon-btn btn-delete" aria-label="Supprimer">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                    <path d="M2 4h12M6 4V2.667A.667.667 0 0 1 6.667 2h2.666A.667.667 0 0 1 10 2.667V4m2 0v9.333a.667.667 0 0 1-.667.667H4.667A.667.667 0 0 1 4 13.333V4h8Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
          <tr>
            <td>6</td>
            <td>Électricité</td>
            <td>Second œuvre</td>
            <td>Installation des circuits électriques</td>
            <td class="illu"><span class="pill pill-blue">1 illustration</span></td>
            <td>
              <div class="action-icons">
                <button class="icon-btn btn-edit" aria-label="Modifier">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <rect x="3" y="4" width="18" height="14" rx="2" stroke="currentColor" stroke-width="1.8"/>
                    <path d="M7 13l3-3 4 5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="9" cy="8" r="1.2" fill="currentColor"/>
                  </svg>
                </button>
                <button class="icon-btn btn-delete" aria-label="Supprimer">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                    <path d="M2 4h12M6 4V2.667A.667.667 0 0 1 6.667 2h2.666A.667.667 0 0 1 10 2.667V4m2 0v9.333a.667.667 0 0 1-.667.667H4.667A.667.667 0 0 1 4 13.333V4h8Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Create Modal -->
  <div class="modal-backdrop" *ngIf="isCreateOpen" (click)="closeCreate()">
    <div #modalContainer class="modal-container" role="dialog" aria-modal="true" aria-labelledby="createStepTitle" tabindex="-1" (click)="$event.stopPropagation()" (keydown)="onModalKeydown($event)">
      <div class="header">
        <div id="createStepTitle" class="title">Créer un modèle d'étape</div>
        <button class="close-btn" type="button" aria-label="Fermer" (click)="closeCreate()">
          <svg width="10" height="10" viewBox="0 0 10 10" fill="none">
            <path d="M9 1L1 9M1 1L9 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>

      <form class="form" (submit)="onCreateSubmit($event)">
        <div class="form-content">
          <div class="row">
            <div class="form-group">
              <div class="label"><span>Nom de l'étape</span><span class="required">*</span></div>
              <input class="input" name="name" type="text" value="Obtention du permis de construire" />
            </div>
            <div class="form-group">
              <div class="label"><span>Ordre</span><span class="required">*</span></div>
              <input class="input" name="order" type="number" value="0" />
            </div>
          </div>

          <div class="form-group">
            <div class="label"><span>Spécialité</span><span class="required">*</span></div>
            <div class="select-wrapper">
              <select class="select" name="specialty">
                <option value="">Sélectionner une spécialité</option>
                <option>Administration</option>
                <option>Terrassement</option>
                <option>Maçonnerie</option>
                <option>Gros œuvre</option>
                <option>Second œuvre</option>
              </select>
              <div class="select-arrow">
                <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                  <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
            </div>
          </div>

          <div class="form-group">
            <div class="label"><span>Description</span></div>
            <textarea class="textarea" name="description">Démarche administrative nécessaire avant de commencer les travaux</textarea>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-cancel" (click)="closeCreate()">Annuler</button>
          <button type="submit" class="btn btn-submit">Enregistrer</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Illustrations Modal -->
  <div class="modal-overlay" *ngIf="isIllustrationsOpen" (click)="closeIllustrations()">
    <div class="illus-modal-container" (click)="$event.stopPropagation()" role="dialog" aria-modal="true" aria-labelledby="illusTitle">
      <!-- Header -->
      <div class="illus-modal-header">
        <div>
          <h2 id="illusTitle" class="illus-modal-title">Gérer les illustrations</h2>
          <p class="step-name">{{ currentStepName || 'Étape' }}</p>
        </div>
        <button class="close-button" type="button" aria-label="Fermer" (click)="closeIllustrations()">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>

      <!-- Content -->
      <div class="illus-modal-content">
        <div class="section-group">
          <h3 class="section-title">Illustrations existantes (1)</h3>
          <div class="illustrations-grid">
            <div class="illustration-card">
              <img class="illustration-image" alt="Aperçu de l'étape"
                   src="https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?q=80&w=2070&auto=format&fit=crop" />
              <div class="illustration-content">
                <h4 class="illustration-title">Aperçu de l'étape</h4>
                <p class="illustration-description">
                  Cette étape cruciale consiste à obtenir le permis de construire, une autorisation administrative indispensable pour démarrer votre projet de construction en toute légalité. Elle garantit que votre projet respecte les règles d'urbanisme en vigueur et prévient d'éventuels problèmes juridiques.
                </p>
                <button class="delete-button" type="button">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M2 4H14M5 4V3C5 2.44772 5.44772 2 6 2H10C10.5523 2 11 2.44772 11 3V4M13 4V13C13 13.5523 12.5523 14 12 14H4C3.44772 14 3 13.5523 3 13V4H13Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Supprimer
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Add button -->
        <div class="section-group" style="margin-top: 1.5rem;" *ngIf="!showAddIllustrationForm">
          <button class="add-button" type="button" (click)="toggleAddIllustration(true)">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M10 4V16M4 10H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="add-button-text">Ajouter une nouvelle illustration</span>
          </button>
        </div>

        <!-- Add form -->
        <div class="form-container" style="margin-top: 1.5rem;" *ngIf="showAddIllustrationForm">
          <h3 class="form-title">Nouvelle illustration</h3>
          <div class="form-group">
            <label class="form-label">Titre <span class="required">*</span></label>
            <input class="form-input" type="text" placeholder="Aperçu de l'étape" />
          </div>
          <div class="form-group">
            <label class="form-label">Description</label>
            <textarea class="form-textarea">Cette étape cruciale consiste à obtenir le permis de construire, une autorisation administrative indispensable pour démarrer votre projet de construction en toute légalité. Elle garantit que votre projet respecte les règles d'urbanisme en vigueur et prévient d'éventuels problèmes juridiques.</textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Image <span class="required">*</span></label>
            <label class="upload-area" (click)="onUploadAreaClick()">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" style="margin-right: 0.5rem;">
                <path d="M11 3H7C5.89543 3 5 3.89543 5 5V15C5 16.1046 5.89543 17 7 17H13C14.1046 17 15 16.1046 15 15V9M11 3L15 7M11 3V7C11 7.55228 11.4477 8 12 8H15M9 11H11M9 14H11M9 8H10" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span class="upload-text">Téléverser une image</span>
              <input #fileInput type="file" class="file-input" accept="image/*" (change)="onFileSelected($event)" />
            </label>
          </div>
          <div class="form-actions">
            <button class="secondary-button" type="button" (click)="toggleAddIllustration(false)">Annuler</button>
            <button class="primary-button" type="button">Ajouter l'illustration</button>
          </div>
        </div>

        <!-- Footer actions -->
        <div class="footer-actions">
          <button class="footer-secondary-button" type="button" (click)="closeIllustrations()">Fermer</button>
          <button class="footer-primary-button" type="button">Enregistrer les modifications</button>
        </div>
      </div>
    </div>
  </div>
</div>
