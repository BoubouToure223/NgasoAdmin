<div class="page container">
  <!-- Header Section -->
  <div class="header-section">
    <div class="header-title">
      <div class="title-text">Gestion des utilisateurs</div>
    </div>
    <div class="header-subtitle">
      <p class="subtitle-text">Gérer les particuliers et professionnels inscrits sur N'gaSo</p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Tabs -->
    <div class="tabs-container">
      <div class="tabs">
        <button
          class="tab-button"
          [ngClass]="{ active: activeTab === 'particuliers' }"
          type="button"
          (click)="selectTab('particuliers')"
          [attr.aria-current]="activeTab === 'particuliers' ? 'page' : null"
        >
          <div class="tab-text">Particuliers</div>
        </button>
        <button
          class="tab-button"
          [ngClass]="{ active: activeTab === 'professionnels' }"
          type="button"
          (click)="selectTab('professionnels')"
          [attr.aria-current]="activeTab === 'professionnels' ? 'page' : null"
        >
          <div class="tab-text">Professionnels</div>
        </button>
      </div>
    </div>

    <!-- Search and Actions -->
    <div class="search-actions-section">
      <div class="search-wrapper">
        <div class="search-container">
          <input
            type="text"
            class="search-input"
            placeholder="Rechercher un utilisateur..."
            aria-label="Rechercher un utilisateur"
            [(ngModel)]="searchText"
            (input)="onSearch()"
          />
          <div class="search-icon" aria-hidden="true">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7.33333 12.6667C10.2789 12.6667 12.6667 10.2789 12.6667 7.33333C12.6667 4.38781 10.2789 2 7.33333 2C4.38781 2 2 4.38781 2 7.33333C2 10.2789 4.38781 12.6667 7.33333 12.6667Z" stroke="#999999" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M14 14L11.1 11.1" stroke="#999999" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </div>
      </div>

      <div class="actions-buttons">
        <button class="action-button">
          <div class="button-icon" aria-hidden="true">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 8H2M8 2L8 14" stroke="#666666" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="button-text">Filtrer</div>
        </button>
        <button class="action-button">
          <div class="button-icon" aria-hidden="true">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 11V14H2V11M11 7L8 10M8 10L5 7M8 10V2" stroke="#666666" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="button-text">Exporter</div>
        </button>
      </div>
    </div>

    <!-- Table: Particuliers -->
    <div class="table-wrapper" *ngIf="activeTab === 'particuliers'">
      <ng-container *ngIf="filteredNovices.length > 0; else noNovices">
        <div class="table-container">
          <table class="users-table tbl" role="table">
            <thead>
              <tr class="table-header">
                <th class="th-nom" scope="col">Nom complet</th>
                <th class="th-email" scope="col">Email</th>
                <th class="th-telephone" scope="col">Téléphone</th>
                <th class="th-adresse" scope="col">Adresse</th>
                <th class="th-projets" scope="col">Projets</th>
                <th class="th-inscription" scope="col">Inscription</th>
                <th class="th-statut" scope="col">Statut</th>
                <th class="th-actions" scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr class="table-row" *ngFor="let user of filteredNovices">
                <td class="td-nom">{{ user.prenom }} {{ user.nom }}</td>
                <td class="td-email">{{ user.email }}</td>
                <td class="td-telephone">{{ user.telephone }}</td>
                <td class="td-adresse">{{ user.adresse }}</td>
                <td class="td-projets">{{ user.nombreProjetsNovice }}</td>
                <td class="td-inscription">{{ user.dateInscription | date: 'dd/MM/yyyy' }}</td>
                <td class="td-statut">
                  <span class="badge" [ngClass]="user.actif ? 'badge-actif' : 'badge-inactif'">
                    {{ user.actif ? 'Actif' : 'Inactif' }}
                  </span>
                </td>
                <td class="td-actions">
                  <button
                    class="action-button"
                    [ngClass]="user.actif ? 'danger' : 'success'"
                    type="button"
                    (click)="toggleUserActive(user)"
                    [attr.aria-label]="user.actif ? 'Désactiver l\'utilisateur' : 'Activer l\'utilisateur'"
                  >
                    <div class="button-text">{{ user.actif ? 'Désactiver' : 'Activer' }}</div>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </ng-container>
      <ng-template #noNovices>
        <div class="empty-state">
          Aucun particulier pour le moment.
        </div>
      </ng-template>
    </div>

    <!-- Table: Professionnels -->
    <div class="table-wrapper" *ngIf="activeTab === 'professionnels'">
      <ng-container *ngIf="filteredProfessionnels.length > 0; else noProfessionnels">
        <div class="table-container">
          <table class="users-table tbl" role="table">
            <thead>
              <tr class="table-header">
                <th class="th-nom" scope="col">Nom complet</th>
                <th class="th-email" scope="col">Email</th>
                <th class="th-telephone" scope="col">Téléphone</th>
                <th class="th-adresse" scope="col">Adresse</th>
                <th class="th-inscription" scope="col">Inscription</th>
                <th class="th-statut" scope="col">Statut</th>
                <th class="th-actions" scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr class="table-row" *ngFor="let user of filteredProfessionnels">
                <td class="td-nom">{{ user.prenom }} {{ user.nom }}</td>
                <td class="td-email">{{ user.email }}</td>
                <td class="td-telephone">{{ user.telephone }}</td>
                <td class="td-adresse">{{ user.adresse }}</td>
                <td class="td-inscription">{{ user.dateInscription | date: 'dd/MM/yyyy' }}</td>
                <td class="td-statut">
                  <span class="badge" [ngClass]="user.actif ? 'badge-actif' : 'badge-inactif'">
                    {{ user.actif ? 'Actif' : 'Inactif' }}
                  </span>
                </td>
                <td class="td-actions">
                  <button
                    class="action-button"
                    [ngClass]="user.actif ? 'danger' : 'success'"
                    type="button"
                    (click)="toggleUserActive(user)"
                    [attr.aria-label]="user.actif ? 'Désactiver l\'utilisateur' : 'Activer l\'utilisateur'"
                  >
                    <div class="button-text">{{ user.actif ? 'Désactiver' : 'Activer' }}</div>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </ng-container>
      <ng-template #noProfessionnels>
        <div class="empty-state">
          Aucun professionnel pour le moment.
        </div>
      </ng-template>
    </div>

    <!-- Confirmation de désactivation -->
    <div *ngIf="showDeactivateConfirm && userPendingDeactivate" class="confirm-row">
      <div class="confirm-content">
        <span>
          Désactiver l'utilisateur
          <strong>{{ userPendingDeactivate.prenom }} {{ userPendingDeactivate.nom }}</strong>
          ?
        </span>
        <div class="confirm-actions">
          <button type="button" class="action-button" (click)="cancelDeactivateUser()">
            <div class="button-text">Annuler</div>
          </button>
          <button type="button" class="action-button danger" (click)="confirmDeactivateUser()">
            <div class="button-text">Désactiver</div>
          </button>
        </div>
      </div>
    </div>

    <!-- Footer Pagination -->
    <div
      class="footer-pagination"
      role="navigation"
      aria-label="Pagination"
      *ngIf="(activeTab === 'particuliers' && filteredNovices.length > 0) || (activeTab === 'professionnels' && filteredProfessionnels.length > 0)"
    >
      <div class="pagination-controls">
        <button
          class="pagination-button"
          type="button"
          (click)="goToPreviousPage()"
          [disabled]="currentPage === 0"
        >
          Précédent
        </button>
        <button
          *ngFor="let page of pages; let i = index"
          class="pagination-button"
          type="button"
          [ngClass]="{ active: i === currentPage }"
          [attr.aria-current]="i === currentPage ? 'page' : null"
          (click)="goToPage(i)"
        >
          {{ i + 1 }}
        </button>
        <button
          class="pagination-button"
          type="button"
          (click)="goToNextPage()"
          [disabled]="currentPage + 1 >= totalPages"
        >
          Suivant
        </button>
      </div>
    </div>
  </div>
</div>
